Even though HTML 5 has been around for over 16 years, PHP never had proper support for it. PHP does have `{php}\DOMDocument`, which _in theory_ should support HTML 4, but it isn't _really_ HTML 4 compliant anymore. 

So, yeah, classic PHP â€” right ðŸ˜…? Well, we can laugh all we want, but let's take a moment to highlight new features that â€” albeit late â€” fix these quirks: [PHP 8.4](/blog/new-in-php-84) is adding an HTML 5 compliant parser! In this post I'll go through the highlights of this new parser, and you can read with me through the whole RFC as well:

<iframe width="560" height="345" src="https://www.youtube.com/embed/cjHRWio-c3M" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

## Backwards compatible

One of the core requirements for this new parser is that it should be fully backwards compatible. That's why internals have chosen to make a completely new class â€” within a new namespace â€” to house the new HTML 5 parser. The old `{php}\DOMDocument` class is left (mostly) alone. The only change in the old implementation is that `{php}\DOMDocument` now extends the abstract `{php}\Dom\Document` class, which is also the parent for the new, HTML 5 compliant implementation: `{php}\Dom\HTMLDocument`. 

If you want to use PHP's new HTML 5 parser, that's the one you need:

```php
// HTML 5 compliant
$dom = \Dom\HTMLDocument::createFromString($html); 
```

While the old version is still available as usual:

```php
// HTML 4-ish support
$oldDom = new \DOMDocument(); 
$oldDom->loadHTML($html);
```

## Constructing DOMs

One key difference you'll spot immediately is that the new implementation relies on static constructors instead of calling methods on the newly created object afterward. The new `{php}HTMLDocument` class has three named constructors available:

```php
HTMLDocument::createEmpty();
HTMLDocument::createFromFile($path);
HTMLDocument::createFromString($html);
```

These are their full signatures:

```php
public static function createEmpty(string $encoding = "UTF-8"): HTMLDocument;
public static function createFromFile(string $path, int $options = 0, ?string $override_encoding = null): HTMLDocument;
public static function createFromString(string $source, int $options = 0, ?string $override_encoding = null): HTMLDocument;
```

For the `$options` variable, these options are available: 

- `{:hl-property:LIBXML_HTML_NOIMPLIED:}`
- `{:hl-property:LIBXML_COMPACT:}`
- `{:hl-property:LIBXML_NOERROR:}`
- `{:hl-type:\Dom\:}{:hl-property:NO_DEFAULT_NS:}`

The `$override_encoding` variable is used to override the implicit encoding detection routines as determined by the HTML parser spec. This can be useful when the document is downloaded manually.

## DOM Objects

Another good design decision is that the resulting `{php}HTMLDocument` contains a list of DOM nodes, which are still represented by old `{php}DOMNode` objects. In fact, all [DOM related value objects](https://www.php.net/manual/en/class.domattr.php) stay the same, regardless of which parser you use. That means you'll be able to switch from the old `{php}\DOMDocument` to the new `{php}\Dom\HTMLDocument`, and all the underlying code should â€” in theory â€” keep working. 

This RFC also adds aliases for those value object classes into the `{php}\Dom` namespace, preparing a possible upgrade path in case the old code needs to move one day. So, for example, `{php}\DOMElement` will also be available as `{php}\Dom\Element`, `{php}\DOMAttribute` as `{php}\Dom\Attribute`, etc. Both versions can be used interchangeably. 

---

Albeit a bit late, I think this is a very nice addition to PHP. I definitely have some usecases for it! What are your thoughts? You can leave them in the comments down below!  